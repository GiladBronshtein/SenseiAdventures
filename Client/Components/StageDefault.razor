@inject HttpClient Http
@inject NavigationManager Nav
@inject IJSRuntime JS
@using template.Shared.Models.Games;
@using template.Shared.Models.Users;
@using template.Client.Components;

<div class="container-fluid">
    <div class="row">
        <div class="col-6">
            <h1>הגדרות המשחק</h1>
        </div>
        @* <div class="col-6">
            <span>בחרו דוכן בסרגל הניווט השמאלי וערכו את השאלות</span>
        </div> *@
    </div>

    @if (gameDataChild != null)
    {
        <!-- Form for new game creation -->
        <EditForm model="gameDataChild" OnValidSubmit="EditSettings" OnInvalidSubmit="failedSubmit">
            <DataAnnotationsValidator />

            <div class="nested">

                <div class="row">
                        <div class="col-md-4">
                            <!-- Game Name -->
                            <div class="mb-2">
                                <label for="gameName" class="form-label">שם המשחק</label>
                                <span>(2-30 תווים)</span>
                                <InputText maxlength="30"
                                            @oninput="@(e => { HandleInputChange(e, nameof(gameDataChild.GameName)); gameDataChild.GameName = e.Value.ToString(); StateHasChanged(); })"
                                            id="gameName"
                                            class="form-control"
                                            @bind-Value="gameDataChild.GameName"
                                            aria-describedby="gameNameHelp" required />
                                <small id="gameName" class="@GetInputClass(gameDataChild?.GameName?.Length ?? 0, 2, 30)">@((gameDataChild?.GameName?.Length ?? 0).ToString())/30</small>
                                <ValidationMessage For="@(() => gameDataChild.GameName)" style="color:Red;" />
                            </div>
                        </div>
                        <div class="col-md-4">
                            <!-- Ending Message -->
                            <div class="mb-2">
                                <label for="endingMessage" class="form-label">הודעת הסיום</label>
                                <span>(2-30 תווים)</span>
                                <InputText maxlength="30"
                                            @oninput="@(e => { HandleInputChange(e, nameof(gameDataChild.EndingMessage)); gameDataChild.EndingMessage = e.Value.ToString(); StateHasChanged(); })"
                                            id="endingMessage"
                                            class="form-control"
                                            @bind-Value="gameDataChild.EndingMessage"
                                            aria-describedby="endingMessageHelp" required />
                            <small id="endingMessage" class="@GetInputClass(gameDataChild?.EndingMessage?.Length ?? 0, 2, 30)">@((gameDataChild?.EndingMessage?.Length ?? 0).ToString())/30</small>
                                <ValidationMessage For="@(() => gameDataChild.EndingMessage)" style="color:Red;" />
                            </div>
                        </div>

                    </div>
                <div class="row">
                    <div class="col-md-2 py-2">
                        <button type="submit" value="send" class="btn btn-primary">שמירה</button>
                    </div>
                </div>
            </div>















        </EditForm>
    }
    else
    {
        <p>Loading...</p>
    }

    <i class="bi bi-badge-vr-fill"></i>

    <div class="row mt-4">
        <div class="col-md-3 col-lg-3 mb-3">
            <div class="card shadow-sm h-100 d-flex flex-column justify-content-center align-items-center">
                <img src="./assets-images/stageBottles1.png" class="card-img-top" alt="Image description">
                <div class="card-body text-center">
                    <h6 class="card-title"> שבירת בקבוקים</h6>
                    <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target=@($"#modal1")>מידע</button>
                </div>
            </div>
        </div>

        <div class="col-md-3 col-lg-3 mb-3">
            <div class="card shadow-sm h-100 d-flex flex-column justify-content-center align-items-center">
                <img src="./assets-images/stageTarget2.png" class="card-img-top" alt="Image description">
                <div class="card-body text-center">
                    <h6 class="card-title"> פגיעה במטרה</h6>
                    <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target=@($"#modal2")>מידע</button>
                </div>
            </div>
        </div>

        <div class="col-md-3 col-lg-3 mb-3">
            <div class="card shadow-sm h-100 d-flex flex-column justify-content-center align-items-center">
                <img src="./assets-images/stageHit3.png" class="card-img-top" alt="Image description">
                <div class="card-body text-center">
                    <h6 class="card-title"> פגיעה בתשובה</h6>
                    <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target=@($"#modal3")>מידע</button>
                </div>
            </div>
        </div>
        <div class="col-md-3 col-lg-3 mb-3">
            <div class="card shadow-sm h-100 d-flex flex-column justify-content-center align-items-center">
                <img src="./assets-images/stageSlash4.png" class="card-img-top" alt="Image description">
                <div class="card-body text-center">
                    <h6 class="card-title"> לחתוך תשובות</h6>
                    <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target=@($"#modal4")>מידע</button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal 1 -->
<div class="modal fade" id=@($"modal1") tabindex="-1" aria-labelledby=@($"modalLabel1") aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id=@($"modalLabel1")>שבירת בקבוקים</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                בדוכן זה תוכלו לשבור בקבוקים ולזכות בפרסים נחמדים
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal">הבנתי</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal 2 -->
<div class="modal fade" id=@($"modal2") tabindex="-1" aria-labelledby=@($"modalLabel2") aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id=@($"modalLabel2")>פגיעה במטרה</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                בדוכן זה תוכלו לפגוע במטרה ולזכות בפרסים נחמדים
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal">הבנתי</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal 3 -->
<div class="modal fade" id=@($"modal3") tabindex="-1" aria-labelledby=@($"modalLabel3") aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id=@($"modalLabel3")>פגיעה בתשובה</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                בדוכן זה תוכלו לפגוע בתשובה ולזכות בפרסים נחמדים
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal">הבנתי</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal 4 -->
<div class="modal fade" id=@($"modal4") tabindex="-1" aria-labelledby=@($"modalLabel4") aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id=@($"modalLabel4")>לחתוך תשובות</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                בדוכן זה תוכלו לחתוך תשובות ולזכות בפרסים נחמדים
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal">הבנתי</button>
            </div>
        </div>
    </div>
</div>


@code
{
    [Parameter]
    public GameDetails gameDataChild { get; set; }

   

    void failedSubmit()
    {
    }

    async Task EditSettings()
    {
    }

    private void HandleInputChange(ChangeEventArgs e, string inputType)
    {
        var newValue = e.Value.ToString();
        switch (inputType)
        {
            case "gameName":
                gameDataChild.GameName = newValue;
                break;
            case "endingMessage":
                gameDataChild.EndingMessage = newValue;
                break;
            default:
                break;
        }

    }
    
    private string GetInputClass(int length, int minChars, int maxChars)
    {
        if (length == 0)
            return "text-muted"; // Neutral for zero characters
        else if (length < minChars)
            return "text-danger";  // Red for less than minimum characters
        else if (length >= minChars && length <= maxChars - 3)
            return "text-success";   // Green for within the normal range
        else if (length > maxChars - 3 && length <= maxChars)
            return "text-warning";  // Orange for nearing maximum length
        return "text-muted";  // Fallback, might not be necessary
    }

}
            